{% extends "base.html" %}

{% block content %}
<div class="search-page">
    <!-- Top bar: search left, context right -->
    <div class="top-bar">
        <div class="search-box">
            <input type="search"
                   id="search-input"
                   name="q"
                   placeholder="Rechercher..."
                   autocomplete="off"
                   hx-get="{{ url_for('search') }}"
                   hx-trigger="input changed delay:300ms, search, focus"
                   hx-target="#dropdown"
                   hx-include=".type-filter input:checked">
        </div>

        <div class="context-selector">
            <select id="context" onchange="setContext(this)">
                <option value="">Toutes structures</option>
                {% for s in structures %}
                <option value="{{ s.id }}"
                        data-name="{{ s.name }}"
                        {% if context.structure_id == s.id %}selected{% endif %}>
                    {{ s.name }}
                </option>
                {% endfor %}
            </select>
        </div>
    </div>

    <!-- Results dropdown (includes type filter) -->
    <div id="dropdown" class="dropdown"></div>
</div>

<script>
function setContext(select) {
    const option = select.options[select.selectedIndex];
    const structureId = option.value;
    const structureName = option.dataset.name || 'Toutes structures';

    const url = new URL('{{ url_for("set_context") }}', window.location.origin);
    url.searchParams.set('structure_id', structureId);
    url.searchParams.set('structure_name', structureName);

    window.location.href = url.toString();
}
</script>
{% endblock %}
