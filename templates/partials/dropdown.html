<div class="dropdown-content">
    <!-- Type filter as toggle buttons -->
    <div class="type-filter">
        <label class="toggle-btn {% if not type_filter %}active{% endif %}">
            <input type="radio" name="type" value="" {% if not type_filter %}checked{% endif %}
                   hx-get="{{ url_for('search') }}"
                   hx-trigger="change"
                   hx-target="#dropdown"
                   hx-include="#search-input">
            Tous
        </label>
        <label class="toggle-btn {% if type_filter == 'users' %}active{% endif %}">
            <input type="radio" name="type" value="users" {% if type_filter == 'users' %}checked{% endif %}
                   hx-get="{{ url_for('search') }}"
                   hx-trigger="change"
                   hx-target="#dropdown"
                   hx-include="#search-input">
            Utilisateurs
        </label>
        <label class="toggle-btn {% if type_filter == 'structures' %}active{% endif %}">
            <input type="radio" name="type" value="structures" {% if type_filter == 'structures' %}checked{% endif %}
                   hx-get="{{ url_for('search') }}"
                   hx-trigger="change"
                   hx-target="#dropdown"
                   hx-include="#search-input">
            Structures
        </label>
        <label class="toggle-btn {% if type_filter == 'services' %}active{% endif %}">
            <input type="radio" name="type" value="services" {% if type_filter == 'services' %}checked{% endif %}
                   hx-get="{{ url_for('search') }}"
                   hx-trigger="change"
                   hx-target="#dropdown"
                   hx-include="#search-input">
            Services
        </label>
    </div>

    {% if results %}
    <!-- Results -->
    {% if results.users.hits %}
    <div class="result-group">
        <div class="group-label">Utilisateurs</div>
        <div class="group-results">
            {% for hit in results.users.hits %}
            <a href="{{ url_for('user_detail', id=hit.id) }}" class="result-item">
                <span class="result-name">
                    {{ hit._formatted.first_name | safe }} {{ hit._formatted.last_name | safe }}
                </span>
                <span class="result-meta">{{ hit.structure_name }}</span>
            </a>
            {% endfor %}
            {% if results.users.estimatedTotalHits > limit %}
            <a href="{{ url_for('results', q=query, type='users') }}" class="show-all">
                voir tous ({{ results.users.estimatedTotalHits }})
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}

    {% if results.structures.hits %}
    <div class="result-group">
        <div class="group-label">Structures</div>
        <div class="group-results">
            {% for hit in results.structures.hits %}
            <a href="{{ url_for('structure_detail', id=hit.id) }}" class="result-item">
                <span class="result-name">{{ hit._formatted.name | safe }}</span>
                <span class="result-meta">{{ hit.type }} - {{ hit.commune }}</span>
            </a>
            {% endfor %}
            {% if results.structures.estimatedTotalHits > limit %}
            <a href="{{ url_for('results', q=query, type='structures') }}" class="show-all">
                voir tous ({{ results.structures.estimatedTotalHits }})
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}

    {% if results.services.hits %}
    <div class="result-group">
        <div class="group-label">Services</div>
        <div class="group-results">
            {% for hit in results.services.hits %}
            <a href="{{ url_for('service_detail', id=hit.id) }}" class="result-item">
                <span class="result-name">{{ hit._formatted.name | safe }}</span>
                <span class="result-meta">
                    {% if hit.theme is iterable and hit.theme is not string %}
                        {{ hit.theme | join(', ') }}
                    {% else %}
                        {{ hit.theme }}
                    {% endif %}
                </span>
            </a>
            {% endfor %}
            {% if results.services.estimatedTotalHits > limit %}
            <a href="{{ url_for('results', q=query, type='services') }}" class="show-all">
                voir tous ({{ results.services.estimatedTotalHits }})
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}

    {% if not results.users.hits and not results.structures.hits and not results.services.hits %}
    <div class="no-results">Aucun resultat pour "{{ query }}"</div>
    {% endif %}
    {% endif %}
</div>
